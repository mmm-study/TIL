---
tags:
  - 도커
  - 쿠버네티스
start-date: 2024-03-17
category: Infra
end-date:
---

# 도커 이미지와 컨테이너

## 1. 도커이미지
- 이미지는 컨테이너를 생성할때 필요한 요소
- 이미지는 여러 개의 계층으로 바이너리 파일로 존재하고,
- 컨테이너 생성하고 실행할 때 읽기 전용으로 사용된다.
- 이미지는 도커 명령어로 내려받을수 있으므로, 설치할 필요없다
- 도커 이미지 형식
	- `[저장소 이름]/[이미지이름]:태그`

## 2. 도커 컨테이너
- 앞에선 만든 이미지로 컨테이너를 생성하면, 이미지의 목적에 맞는 파일이 들어있는 파일시스템과 격리된 시스템 자원 및 네트워크를 사용할수 있는 **독립된 공간** 이 생성

## 도커 컨테이너 다루기
- `docker run -i -t ubuntu:14.04 `
	- -i :상호 입출력
	- -t:  tty를 활성화 bash 셀 사용
- docker 내부 명령어
	- `exit`,`ctrl+D` : 컨테이너를 정지하고 나오기
	- `ctrl+P,Q` : 컨테이너를 정지시키지않고 나오기
- docker 명령어
	- `docker pull 이미지:버전` docker 이미지를 받아오기
	- `docker images` : docker에 존재된 이미지 버전들
	- `docker create -i -t --name 이름 이미지` docker 컨테이너를 설치하는 명령어(run과 다르게 설치 후 컨테이너 내부로 들어가지 않는다.)
	- `docker start 컨테이너이름` : 컨테이너를 실행한다.
	- `docker attach 컨테이너이름` :컨테이너 내부로 들어간다.
	- `docker ps` 실행중인 컨테이너 목록을 확인
		- 모든 컨테이너를 확인하기 위해서 `-a` 라는 플래그를 넣는다.
		- CONTAINER ID : 컨테이너에 할당된 ID (`docker inspect` 를 하면 고유한ID 확인 가능)
		- IMAGE : 컨테이너에 사용된 이미지
		- COMMAND : 컨테이너가 실행될때 실행될 명령어
		- CREATED :  컨테이너가 생성되고 난 뒤 흐른 시간
		- STATUS : Up -> 실행중인 상태  | Exited-> 종료된 상태 | Pause -> 일시 정지된 상태
		- PORTS : 컨테이너가 개방한 포트와 호스트에 연결한 포트를 나열
		- NAME : 컨테이너의 고유한 이름 
	- `docker rm 컨테이너 이름`
		- 실행 중인 컨테이너는 삭제하지 못한다.
		- `-f` 를 통해 강제로 삭제할수 있다.
	- `docker container prune`
		- 모든 컨테이너 삭제
	- `docker ps -a -q`
		- docker의 컨테이너 리스트를 출력
		- `-a` : 모든 컨테이너 플래그
		- `-q` : 컨테이너 아이디만 출력
		- 이 명령어를 활용하여, 모든 컨테이너의 ID를 가지고 삭제나 stop가능
	```ubuntu
	docker stop $(docker ps -a -q)
	docker rm $(docker ps -a -q)
	```

## 컨테이너 외부 노출
- 컨테이너는 가상 머신과 마찬가지로 가상 IP를 할당
- 아무런 설정을 하지 않으면 이 컨테이너는 외부에서 접근할 수 없으며, 도커가 설치된 호스트에서만 접근 가능
- 컨테이너 애플리케이션을 노출하기 위해서는 eth0의 IP와 포트를 호스트의 IP와 포트에 바인딩 해야한다.
```
docker run -i -t --name mywebserver -p 80:80 ubuntu:14.04
```
- `-p` 옵션은 컨터이너의 포트를 호스트의 포트와 바인딩해 연결할수 있게 설정
	- `[호스트의 포트]:[컨테이너의 포트]`
- 여러개의 포트를 개방하기위해서는 `-p` 를 여러개를 설치